# SPA ClientApp created using the Aurelia CLI

Aurelia CLI was used to create the ClientApp dir, the Aurelia template files from the "Aurelia Skeleton Navigation" repo and template files from the retired "Microsoft.AspNetCore.SpaTemplate" package were then added and combined.
The "Microsoft.AspNetCore.SpaTemplate" uses a vertical nav menu, this was used to create a sub-menu (child router) navigation within the "Aurelia Skeleton Navigation" template. A small amount of refactoring was done to combine and organise the template.

Files from the "Aurelia Skeleton Navigation" webpack template were used:
https://github.com/aurelia/skeleton-navigation/tree/master/skeleton-typescript-webpack


# Build Notes

### Install the Aurelia CLI
```npm install aurelia-cli -g```

### Aurelia Project Creation and Configuration

Rename / move or delete the existing ClientApp dir.
Run this from within the dotnet project folder:

```au new```

Options chosen: (to match the "skeleton-typescript-webpack" project)

    Name: ClientApp
    Platform: Web
    Bundler: Webpack
    Loader: None
    Transpiler: TypeScript
    Markup Processor: Minimal Minification
    CSS Processor: PostCSS
    Unit Test Runner: Karma
    Unit Test Runner: Jest
    Integration Test Runner: Protractor
    Editor: Visual Studio Code
Would you like to install the project dependencies?

    2. Yes, use NPM

A new ClientApp dir will now have been generated.

### Update the ClientApp dir

Add the files from the Aurelia Skeleton Navigation repo to the ClientApp project generated by the CLI.
Use the last commit before it was upgraded to bootstrap 4:

https://github.com/aurelia/skeleton-navigation/commit/6f4ec02136bfdd4f4575850d32b02d369a26b4bb

### Running and building

#### Run in dev mode

Builds the app and then launches

```au run```

or

```npm start```

Launches in Watch mode (Watches source files for changes and refreshes the bundles automatically)

```au run --watch```

or launch in Hot Module Reload mode

```au run --watch --hmr```

Note: The Font Awesome spinner on the splash screen that appears while Aurelia is loading in the browser does not appear in dev mode because the CSS is concatenated and added added inline with the index.html page for performance reasons.
The Webpack extractCss plugin needs to be used which is the default in production mode to separate out the CSS.
https://github.com/aurelia/skeleton-navigation/issues/855

Run in dev mode with extractCss plugin to disable inline css used in dev mode:

```npm start -- webpack.server.extractCss```

#### Analyze in dev mode

```au run --analyze```

opens up the Webpack Bundler Analyzer, giving a visualization of the bundle contents.


#### Build in production mode:

```au build --env prod```

output will end up in the dist folder, everything you need to deploy can be found in the dist folder. Just copy this to the webserver and you'll be good to go.

#### Run in production mode:

```au run --env prod```

or

```au run --watch --env prod```

or

```npm start -- build```

```npm start -- serve```

#### Analyze in production mode

```au run --analyze --env prod```

### Testing

This skeleton provides three frameworks for running tests. You can choose one or two and remove the other, or even use all of them for different types of tests. By default, both Jest and Karma are configured to run the same tests with Jest's matchers (see Jest documentation for more information).

If you wish to only run certain tests under one of the runners, wrap them in an `if`, like this:

```js
if (jest) {
  // since only jest supports creating snapshot:
  it('should render correctly', () => {
    expect(document.body.outerHTML).toMatchSnapshot();
  });
}
```

#### Jest + Jasmine 2

Jest is a powerful unit testing runner and framework.
It runs really fast, however the tests are run under NodeJS, not the browser.

```au jest```

```au jest watch```


#### Karma + Jasmine 2

Karma is also a powerful test runner, which by default runs in the browser. This means that whatever works in real browsers, should also work the same way in the unit tests. But it also means the framework is heavier to execute and not as lean to work with.

```au karma```

To run the Karma watcher (re-runs tests on changes), run:

```au karma --watch```

#### Protractor (E2E / integration tests)

Integration tests can be performed with [Protractor](http://angular.github.io/protractor/#/).

1. Place your E2E-Tests into the folder ```test/e2e``` and name them with the extension `.e2e.ts`.

2. Run the tests by invoking

```au protractor```
